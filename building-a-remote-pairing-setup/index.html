<!DOCTYPE html>
<html>
<head>
  <title>Build a Command Line Remote Pairing Setup</title>
  <link href="/assets/stylesheets/style.css?1580666945" type="text/css" rel="stylesheet" />
  
  <link rel="canonical" href="" />
  

  <link type="text/atom+xml" rel="alternate" href="http://feeds.feedburner.com/zeespencer"/>
  <meta name="viewport" content="initial-scale=1" />
    <script type="text/javascript">
      !function(){var analytics=window.analytics=window.analytics||[];if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","group","track","ready","alias","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="3.0.0";
      
      analytics.load("DEDSLhOPXKFCHg4NglvHWqtQg6BgqJy2");
      

      
        analytics.page("Article", null);
      
      }}();
    </script>
    <script type="text/javascript" src="/assets/js/site.js?1580666945"></script>
</head>
<body>
  <div id="page">
  <header>
    <figure>
      <img src="/assets/images/zee.png?1580666945" alt="Zee Spencer" />
    </figure>
    
      <nav>
  <a href="/">Explore</a>
  <a href="/newsletter.html">Subscribe to my Newsletter</a>
  <a href="/contact.html">Contact Me</a>
  <a class="twitter" href="http://twitter.com/zspencer">Twitter</a>
  <a class="github" href="http://github.com/zspencer">Github</a>
  <a class="rss" href="http://feeds.feedburner.com/zeespencer">RSS</a>
</nav>

      <h2>Build a Command Line Remote Pairing Setup</h2>
    

  </header>
  <main id="content">
    <section id="article">
<p>Over the past couple years I&#39;ve done a bit of remote pairing. When I need a GUI
everything is pretty straightforward: <a href="http://join.me">Join.me</a> for
screen/keyboard sharing and iPad with Skype or Google Hangout for video calls.
This is pretty bandwidth intensive and can be slow, so I&#39;d rather keep as much
as I can in a terminal.</p>

<p>There&#39;s a few obstacles to that though:</p>

<ul>
<li> I travel a lot, so my network location is random and I can&#39;t change the
coffee shops firewall</li>
<li> I want to see anything my partner do</li>
<li> I want to add partners easily</li>
<li> I don&#39;t want to share any passwords.</li>
</ul>

<p>Thankfully a remote virtual machine, SSH, and tmux let me meet all these
requirements. Hooray!</p>

<h2 id="set-up-the-remote-server">Set up the remote server</h2>

<p>I use <a href="http://prgmr.com/xen/">prgmr.com</a> for my utility server provider.
They&#39;ve got great support, don&#39;t overload their servers, and they love their
customers. This is a pretty low intensity server, so a 128MB instance is
probably fine.</p>

<p>Add two user accounts. One is for you to log in to and manage the server. Don&#39;t
even think about using root! The other is for your partners to log in with. I
use the name <code>pair</code> for mine.</p>

<p>For some distributions of *nix you&#39;ll need to allow port forwarding over SSH.
To do this open up the servers sshd_config as root (typically located at
<code>/etc/ssh/sshd_config</code>), find or add the  <code>AllowTcpForwarding</code> line, set it to
<code>yes</code>, and ensure it&#39;s uncommented.</p>

<h3 id="configure-your-user">Configure your user</h3>

<p>Your user&#39;s role on this server is to allow you to use SSH to forward a port on
the server to your system. To be honest, you don&#39;t need to change anything, but
I recommend using keys to access your server instead of a password. To do that,
you&#39;ll need to create an <code>authorized_keys</code> file in your <code>~/.ssh</code> directory.
This file must <em>be only accessible to your user</em> otherwise it will not be
accepted by any sane distributions ssh server. To make it yours and yours
alone, type <code>chmod 600 ~/.ssh/authorized_keys</code> before going forward.</p>

<p>Now, append your public key to the <code>~/.ssh/authorized_keys</code> file. Github
provides an <a href="https://help.github.com/articles/generating-ssh-keys">excellent tutorial on creating ssh
keys</a> if you don&#39;t think
you have a public key.</p>

<p>From now on, typing <code>ssh your-user@your-server</code> willÂ use key-pair
encryption to verify your identity; which is far more secure than meager
passwords. For an added security boost you may want to edit your
<code>/etc/ssh/sshd_config</code> and change <code>PasswordAuthentication</code> to <code>no</code> <em>after
you&#39;ve verified logging in without a password works.</em></p>

<h3 id="configure-the-pair-user">Configure the pair user</h3>

<p>The pair user is where the magic happens. Login to the pair user, and create an
authorized keys file by typing <code>touch ~/.ssh/authorized_keys</code> and change it&#39;s
permissions <code>chmod 600 ~/.ssh/authorized_keys</code>!</p>

<h4 id="adding-a-partners-public-key">Adding a partners public key</h4>

<p>When we append a partners public key to the authorized_keys file we want to
prefix it with the <code>command</code> ssh directive:</p>

<p><code>command=&quot;ssh &lt;my-user-name&gt;@localhost -p 1337&quot;,no-port-forwarding,no-X11-forwarding,no-agent-forwarding &lt;my-partners-public-key&gt;</code></p>

<p>This forces the incoming connection to execute an ssh command to connect to
localhost on port 1337, and once that is complete it will kill the connection.
The <code>no-(agent|port|X11)-forwarding</code> directives are another security
precaution. Now we can add anyone we want as a partner with very little fear.</p>

<p>Go ahead and add your public key as a partner for now, then from your local
machine type <code>ssh pair@your-server</code>. This should give you a message like
<code>ssh: connect to host localhost port 1337: Connection refused</code></p>

<p>This is good! It means that you successfully connected as <code>pair</code> on your server
<em>and</em> it tried to connect to ssh on port 1337! Yay!</p>

<p>All that&#39;s left to do now is to generate an ssh key for the pair user, so log
back in to the server as <code>pair</code> and follow step 3 on the aforementioned <a href="https://help.github.com/articles/generating-ssh-keys">ssh
key tutorial</a>. This is
the key we&#39;ll give access rights to our machine; using the <code>command</code> directive
to always force them into joining an existing tmux session.</p>

<h2 id="set-up-your-machine">Set up your machine</h2>

<h3 id="install-tmux">Install tmux</h3>

<p>If you&#39;re on a Mac I recommend installing tmux through
<a href="http://mxcl.github.com/homebrew/">homebrew</a>. Most Linux distributions come
with it as a package in their standard repository now a days.</p>

<h3 id="set-up-your-local-ssh-server-and-authorized_keys">Set up your local ssh server and authorized_keys</h3>

<p>If you&#39;re on a mac, you&#39;ll need to <a href="http://osxdaily.com/2011/09/30/remote-login-ssh-server-mac-os-x/">enable remote
login</a>. If
you&#39;re a Linux person make sure you have the sshd package installed and the
service running.</p>

<p>Once that&#39;s done, set up your authorized_keys for your local machine: <code>touch
~/.ssh/authorized_keys &amp;&amp; chmod 600 ~/.ssh/authorized_keys</code></p>

<p>Now take the public key you created for the pair username, and add it to the
end of your <code>~/.ssh/authorized_keys</code> file, like so:</p>

<p><code>command=&quot;tmux attach&quot;,no-port-forwarding,no-X11-forwarding,no-agent-forwarding &lt;pair-users-ssh-public-key&gt;</code></p>

<h3 id="test-it-out">Test it out</h3>

<p>From your local machine open a new terminal and type <code>ssh -R1337:localhost:22
your-user@your-server</code> . This sets up the network forwarding stuff. Yay!</p>

<p>From a second terminal, type in <code>ssh pair@your-server</code>. This should give you
at least these two lines:  <code>no sessions</code> and <code>Connection to localhost closed</code>.</p>

<p>The <code>no sessions</code> line is letting us know tmux doesn&#39;t have anything to attach
to. the <code>Connection to localhost closed</code> is letting us know that we were kicked
off the system. As we should be!</p>

<p>Now, on <em>another</em> terminal launch <code>tmux</code>, then from the second terminal try
<code>ssh pair@your-server</code> again. If all goes well, you should see the contents
of the third terminal in the second terminal, and it should redraw pretty fast.</p>

<h3 id="further-enhancements">Further enhancements</h3>

<p>This is my vanilla command line remote pairing environment. If you want more
power, there&#39;s a few things you should do:</p>

<ul>
<li>Read the <a href="http://pragprog.com/book/bhtmux/tmux">tmux book</a></li>
<li>Enhance tmux with <a href="https://github.com/zolrath/wemux">wemux</a> or <a href="https://github.com/benmills/vimux">vimux</a></li>
<li>Look into <a href="http://mosh.mit.edu/">mosh</a> as an ssh alternative. It&#39;s supposed to be great for low-bandwidth situations.</li>
</ul>

</section>

<hr />
<section id="post-tags">
  <p>Browse posts about:
  <ul>
  
  <li><a href="/tags/pairing.html">pairing</a></li>
  
  <li><a href="/tags/software-as-craft.html">software-as-craft</a></li>
  
  <li><a href="/tags/devenvironment.html">devenvironment</a></li>
  
  </ul></p>
</section>

<section id="newsletter-signup">
  <p>Want to get notified when I publish new articles or update old ones?
  Subscribe to my newsletter. It's a weekly-ish set of interesting links with a
  short essay on programming, design, technical leadership, or anything else
  that strikes my fancy.</p>

  <form id="subscribe-to-newsletter" action="https://tinyletter.com/zspencer" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/zspencer', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true">
  <p><label for="tlemail">Email address:</label>
  <input placeholder="your-email@example.com" type="text" name="email" id="tlemail" /></p>
  <input type="hidden" value="1" name="embed"/>

  <p>Not sure? <a id="newsletter-archive" href="http://tinyletter.com/zspencer/archive">Read the
    archive.</a></p>
  <input class="button" type="submit" value="Subscribe Now!" />
</form>

<script type="text/javascript">
Track.cta("#subscribe-to-newsletter", "Newsletter Subscription", {
  location: 'bottom',
  color: 'Red',
  category: 'Subscribe',
  pageSubject: 'Article'
});

Track.cta("#newsletter-archive", "Check the Newsletter Archive", {
  location: 'bottom',
  color: 'Red',
  category: 'Investigate me',
  pageSubject: 'Article'
});
</script>

</section>

  </main>
  <div class="push"></div>
  </div>
  <footer>
    <section id="footer-content">
      <nav>
  <a href="/">Explore</a>
  <a href="/newsletter.html">Subscribe to my Newsletter</a>
  <a href="/contact.html">Contact Me</a>
  <a class="twitter" href="http://twitter.com/zspencer">Twitter</a>
  <a class="github" href="http://github.com/zspencer">Github</a>
  <a class="rss" href="http://feeds.feedburner.com/zeespencer">RSS</a>
</nav>

      <p class="license">
        Copyright 2004 - 2014 Zee Spencer. Licensed under
        a <a
           rel="license"
           href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative
           Commons Attribution-NonCommercial-ShareAlike 4.0
           International License</a>.
      </p>
    </section>
  </footer>

<script type="text/javascript">

</script>
</body>
</html>
